<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Conta - Mercado Primavera</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <header id="cabecalho">
        <nav class="navbar navbar-expand-lg">
          <div class="container-fluid">
            <a class="navbar-brand" href="index.html">Mercado Primavera</a>
            <button id="botao" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active" href="index.html">Início</a></li>
                <li class="nav-item"><a class="nav-link" href="entrar.html">Entrar</a></li>
                <li class="nav-item"><a class="nav-link" href="perfil.html">Minha Conta</a></li>
                <li class="nav-item"><a class="nav-link" href="carrinho.html">Carrinho</a></li>
                <li class="nav-item"><a class="nav-link" href="avaliacao.html">Avaliação</a></li>
              </ul>
            </div>
          </div>
        </nav>
    </header>
    
    <main class="container mt-4">
        <h2>Minha Conta</h2>
        <div class="row">
            <div class="col-md-6">
                <h4>Meus Dados</h4>
                <form id="perfil-form">
                    <div class="mb-3">
                        <label class="form-label">Nome:</label>
                        <input type="text" class="form-control" id="nome" disabled>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Sobrenome:</label>
                        <input type="text" class="form-control" id="sobrenome" disabled>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">E-mail:</label>
                        <input type="email" class="form-control" id="email" disabled>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Senha:</label>
                        <input type="password" class="form-control" id="senha" disabled>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Telefone:</label>
                        <input type="text" class="form-control" id="telefone" disabled>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">CEP:</label>
                        <input type="text" class="form-control" id="cep" disabled>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Endereço:</label>
                        <input type="text" class="form-control" id="endereco" disabled>
                    </div>
                    <button type="button" class="btn btn-warning" onclick="habilitarEdicao()">Alterar</button>
                    <button type="button" class="btn btn-primary d-none" id="salvar-btn" onclick="salvarDados()">Salvar Alterações</button>
                    <button type="button" class="btn btn-danger" id="btn-sair" onclick="sair()">Sair</button>
                </form>
            </div>
            <div class="col-md-6">
                <h4>Pedidos Realizados</h4>
                <ul class="list-group" id="lista-pedidos">
                    <div id="pedidosRealizados"></div>
                </ul>
            </div>
        </div>
    </main>
    
    <footer id="rodape" class="mt-4 p-3 text-center">
        <p>&copy; 2025 Mercado Primavera - Todos os direitos reservados.</p>
    </footer>
    <!-- acessibilidade -->
    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
    new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        carregarDados();
        carregarPedidos();
    });

    document.addEventListener("DOMContentLoaded", function() {
    const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"));

    if (!usuarioLogado) {
        alert("Você precisa fazer login primeiro!");
        window.location.href = "entrar.html";
        return;
    }

    // Preencher os campos do perfil
    document.getElementById("nome").value = usuarioLogado.nome;
    document.getElementById("sobrenome").value = usuarioLogado.sobrenome;
    document.getElementById("email").value = usuarioLogado.email;
    document.getElementById("senha").value = usuarioLogado.senha;
    document.getElementById("telefone").value = usuarioLogado.telefone;
    document.getElementById("cep").value = usuarioLogado.cep;
    document.getElementById("endereco").value = usuarioLogado.endereco;
    });

    // Função para sair corretamente
    function sair() {
        sessionStorage.clear();
        localStorage.removeItem("usuarioLogado"); // Apenas remove o login

        window.location.href = "entrar.html";
    }

    // Associar a função ao botão de sair
    document.getElementById("btn-sair").addEventListener("click", sair);

    function habilitarEdicao() {
        document.querySelectorAll("#perfil-form input").forEach(input => input.removeAttribute("disabled"));
        document.getElementById("salvar-btn").classList.remove("d-none"); // Exibe botão de salvar
    }

    function salvarDados() {
        const usuario = {
            nome: document.getElementById("nome").value,
            sobrenome: document.getElementById("sobrenome").value,
            email: document.getElementById("email").value,
            senha: document.getElementById("senha").value,
            telefone: document.getElementById("telefone").value,
            cep: document.getElementById("cep").value,
            endereco: document.getElementById("endereco").value
        };

        localStorage.setItem("usuarioLogado", JSON.stringify(usuario)); // Atualiza os dados no localStorage
        alert("Dados salvos com sucesso!");
        location.reload(); // Recarrega a página para desativar os campos novamente
    }
    function salvarPedido(pedido) {
        const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
        if (!usuario) return;

        const email = usuario.email;
        let historico = JSON.parse(localStorage.getItem("pedidosPorUsuario")) || {};
        if (!historico[email]) {
            historico[email] = [];
        }

        historico[email].push(pedido);
        localStorage.setItem("pedidosPorUsuario", JSON.stringify(historico));
    }
    function carregarPedidos() {
        let pedidos = JSON.parse(localStorage.getItem('pedidosRealizados')) || [];
        const pedidosDiv = document.getElementById('pedidosRealizados');

        if (pedidos.length === 0) {
            pedidosDiv.innerHTML = '<p>Nenhum pedido realizado.</p>';
            return;
        }

        pedidosDiv.innerHTML = '';
        pedidos.forEach(pedido => {
            const pedidoElemento = document.createElement('div');
            pedidoElemento.classList.add('border', 'p-3', 'mb-2');
            pedidoElemento.innerHTML = `
                <h5>Pedido #${pedido.numero}</h5>
                <p>Data: ${pedido.data}</p>
                <p>Valor: ${pedido.valor}</p>
                <h6>Itens:</h6>
                <ul>
                    ${pedido.itens.map(item => `<li>${item.quantidade}x ${item.nome} - ${item.preco}</li>`).join('')}
                </ul>
            `;
            pedidosDiv.appendChild(pedidoElemento);
        });
    }

    document.addEventListener("DOMContentLoaded", carregarPedidos);
    </script>
</body>
</html>
